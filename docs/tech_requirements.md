# 1. Цель проекта

Цель проекта — разработать приложение - клон популярной игры-викторины [SIGame](https://vladimirkhil.com/si/game)
для игроков и авторов(далее Приложение). Автор сможет создавать в Приложении вопросы, группировать вопросы в темы,
упаковывать темы вопросов в этапы и создавать из этапов пакеты вопросов, которые будут основой для игры и контентом для игроков.

В игре смогут участвовать до 12 игроков, один из которых будет ведущим. За каждый правильно отвеченный вопрос игрок
будет получать очки, победит тот игрок, который к концу игры наберет наибольшее число очков.

# 2. Описание Приложения

Приложение состоит из следующих основных функциональных блоков:
- Регистрация и авторизация
- Функционал для автора (управление пакетами с вопросами)
- Функционал для игроков
- Функционал для ведущего
- Функционал комнаты

## 2.1. Типы пользователей

Приложение подразумевает 3 типа пользователей: автор, неавторизованный игрок и игрок. Автор создает пакеты с вопросами,
а игрок и неавторизованный игрок могут выбрать созданные автором пакет(ы) при создании игры.

## 2.2. Регистрация

Чтобы принять участие в игре, необязательно заводить аккаунт, достаточно указать отображаемое имя при входе, но чтобы
появилась возможность создавать и публиковать пакеты с вопросами, нужно зарегистрироваться и подтвердить адрес эл.
почты.

Для успешной регистрации в Приложении необходимо отправить форму со следующими полями:
- nickname — обязательное поле
- email — обязательное поле
- password — обязательное поле

После успешной отправки формы на сервер, на указанный адрес эл. почты придет письмо с ссылкой,
перейдя по которой можно подтвердить эл.почту и появится возможность создавать пакеты.

В последующих версиях OAuth2 регистрация через Google, Discord, GitHub или др.

## 2.3. Авторизация

В Приложении должна быть возможность авторизации по логину или адресу эл. почты:
- login — обязательное поле (nickname или email)
- password — обязательное поле

В последующих версиях OAuth2 авторизация через Google, Discord, GitHub или др.

## 2.4. Функционал для автора (управление пакетами с вопросами)

### 2.4.1. Создание пакетов

Пакет вопросов состоит из трех частей:
- этапы игры (от 2 до 6 этапов)
- темы вопросов (от 3 до 10 вопросов)
- вопросы

Создание пакета в приложении должно делится на 4 части:

1. Заполнение основных полей для сущности “пакет”:
    - Название пакета — обязательное поле
    - Обложка пакета — необязательное поле
2. Добавление этапов игры в пакет:
    - Заголовок этапа (название) — обязательное поле (по умолчанию именуется “Stage 1”
    - Является ли этап финальным (да или нет) — обязательное поле (по умолчанию последний этап является финальным)
3. Добавление тем вопросов в этап:
    - Создание новой темы вопросов
        - Заголовок темы — обязательное поле
    - Поиск тем вопросов в Приложении:
        - Поиск по заголовку темы — обязательное поле
        - Фильтр по дате создания — необязательное поле (по умолчанию Новые)
        - Оставить вопросы, присущие найденной теме — обязательное поле (по умолчанию Да)
4. Добавление вопросов в темы (вопросы могут быть нескольких обычными, со ставкой, секретными, супер секретными, без риска):
    - Создание нового вопроса (обычного, со ставкой, без риска):
        - Вопрос — обязательное поле
        - Медиа — необязательное поле (изображение, аудио или видео)
        - Цена вопроса — обязательное поле
        - Интервал времени, который выделяется на ответ игроку — обязательное поле
        - Комментарий для ведущего — необязательное поле
        - Ответ — обязательное поле
        - Изображение ответа — необязательное поле
    - Создание нового секретного вопроса (тема и стоимость не отображается игрокам):
        - Вопрос — обязательное поле
        - Медиа — необязательное поле (изображение, аудио или видео)
        - Цена вопроса — обязательное поле
        - Интервал времени, который выделяется на ответ игроку — обязательное поле
        - Комментарий для ведущего — необязательное поле
        - Ответ — обязательное поле
        - Изображение ответа — необязательное поле
        - Скрытая цена вопроса — обязательное поле (фактическая цена секретного вопроса, может быть такой же как и Цена вопроса)
        - Тема вопроса — обязательное поле (секретные вопросы имеют свою тему, может быть такой же как и тема, к которой вопрос принадлежит)
    - Создание нового супер секретного вопроса (тема и стоимость могут отображаться игрокам, возможность оставить вопрос себе):
        - Вопрос — обязательное поле
        - Медиа — необязательное поле (изображение, аудио или видео)
        - Цена вопроса — обязательное поле
        - Интервал времени, который выделяется на ответ игроку — обязательное поле
        - Комментарий для ведущего — необязательное поле
        - Ответ — обязательное поле
        - Изображение ответа — необязательное поле
        - Скрытая цена вопроса — обязательное поле (фактическая цена секретного вопроса, может быть такой же как и Цена вопроса)
        - Тема вопроса — обязательное поле (секретные вопросы имеют свою тему, может быть такой же как и тема, к которой вопрос принадлежит)
        - Тема и стоимость вопроса отображаются игрокам — обязательное поле (по умолчанию Нет)
        - Можно оставить вопрос себе — обязательное поле (по умолчанию Нет)
    - Поиск вопроса в Приложении и добавление в пакет:
        - Вопрос — обязательное поле
        - Фильтр по типу вопроса — необязательное поле (по умолчанию Все)
        - Фильтр по дате создания — необязательное поле (по умолчанию Новые)

### 2.4.2. Редактирование пакетов

У авторов должна быть возможность редактировать созданные ими пакеты:
- Изменение названия пакета
- Изменение/Удаление обложки пакета
- Добавление/Удаление этапов
- Изменение финального этапа
- Изменение имени этапа
- Добавление/Удаление/Изменение тем вопросов
- Добавление/Удаление/Изменение вопросов

Дописать описание функционала для игроков и ведущего

## 2.5. Функционал для игроков

### 2.5.1. Создание комнаты

Создать комнату может только авторизованный игрок:
- по имени пользователя (без регистрации)
- по логину (имени пользователя или адресу эл.почты см. пункт 2.2) и паролю (после регистрации)

Для создания комнаты необходимо заполнить следующие поля:
- Имя комнаты — обязательное поле (не уникальное)
- Пароль — необязательное поле
- Пакет вопросов — обязательное поле (поиск в Приложении или случайный выбор, случайный по умолчанию)
- Роль — обязательное поле (игрок или ведущий, по умолчанию игрок)
- Количество игроков — обязательное поле (от 2 до 12 игроков, 2 по умолчанию)

Также при создании комнаты есть возможность настроить:
- Фальстарты — обязательное поле (нельзя нажимать на кнопку до окончания чтения вопроса, по умолчанию Да)
- Время на выбор вопроса — обязательное поле (от 1 до 120 секунд, по умолчанию 30)
- Время на передачу секретного вопроса — обязательное поле (от до 60, по умолчанию 15)
- Время на принятие решений ведущим — обязательное поле (от 1 до 300 секунд, по умолчанию 30)

Начать игру нельзя, если ведущий не был выбран.
Начать игру может только создатель комнаты, вне зависимости от его роли.

### 2.5.2. Вход в комнату

Войти в созданную заранее комнату можно двумя способами:
1. Найти комнату в списке всех комнат
2. Найти комнату по поисковому запросу по имени комнаты

При заходе в комнату необходимо ввести пароль, если он был установлен создателем.
Если Игрок заходит в комнату и игра еще не началась, ему дается возможность выбрать роль Ведущего, если она не занята.
После захода в комнату, зашедшему игроку в уже начатую игру присваевается роль Игрок.

### 2.5.3. Выбор вопроса

У каждого игрока есть ограниченное количество времени на выбор вопроса (смотреть п. 2.5.1).

### 2.5.4. Ответ на вопрос

#### Обычный вопрос

Вопрос задается игроком, у всех игроков есть время на ответ. Нажавший раньше остальных отвечает.
В случае верного ответа стоимость вопроса прибавляется к счету игрока, отнимается если ответ неверный.
В случае неверного ответа, кнопку снова могут жать не отвечавшие игроки.

#### Без риска

За правильный ответ - удвоенное количество очков, за неверный - игрок ничего не теряет.

#### Аукцион (вопрос со ставкой)

При розыгрыше этого вопроса игроки последовательно, в порядке возрастания сумм (но начиная с того, кому вопрос достался)
делают ставки, перекрывая ставки оппонентов.
Минимальная ставка равна номинальной стоимости вопроса.
Можно сказать «Пас» и выйти из торгов. Можно пойти «ва-банк» — поставить всё на кон. Ва-банк перекрывает все простые
ставки, но пойти ва-банк можно только перекрывая по сумме предыдущую ставку.
Тот, кто поставит больше остальных, и будет единилично играть этот вопрос. Он будет обязан отвечать.
Стоимость вопроса равна стоимости ставки играющего.

#### Секретный вопрос

Если игрок выбрал вопрос и он оказался секретным или супер секретным, в зависимости от настроек Пакета вопросов, у него
должна быть возможность передать вопрос другому игроку, или оставить себе. На передачу секретного вопроса выделяется
ограниченное количество времени (смотреть настройки в п. 2.5.1).

Вопрос имеет собственную тему и стоимость, неизвестную до отдачи.

#### Супер секретный вопрос

Идентичен секретному вопросу, с некоторыми отличиями:
- есть возможность оставить себе
- тема и стоимость могут быть известны заранее

### 2.5.5. Финал

В финальном раунде игроки по очереди (от наибольшего кол-ва очков) убирают по 1 теме по не останется 1 тема (количество
тем равно количеству игроков + 1).

Автоматически выбирается вопрос из выбранной темы, затем игроки делают ставки. После закрытия ставок все игроки отвечают
на вопрос в поле ввода, который виден только ведущему. По истечению времени, выделенного на ответ, ведущий отмечает
игроков, ответивших правильно. Ответившим правильно игрокам начисляется количество очков, которые он поставил плюс
стоимость вопроса.

Если нет игроков с одинаковым количеством очков, игра заканчивается, победителем становится игрок с наибольшим кол-вом
очков.

Если есть игроки с одинаковым кол-вом очков - автоматически выбирается вопрос и процесс повторяется. (вопрос, на который
уже отвечали игроки не может быть выбран снова).

### 2.5.6. Оценка пакета вопросов

После окончания игры, каждый игрок, включая ведущего, должен иметь возможность оценить Пакет вопросов от 1 до 5, или не
оценивать вовсе.

### 2.5.7. Добавление пакета в избранное

После окончания игры, каждый игрок также имеет возможность добавить пакет в избранное.
Добавить пакет в избранное можно также из Редактора пакетов.

## 2.6. Функционал для ведущего

### 2.6.1. Старт игры

После начала игры ведущий выбирает игрока, который будет выбирать тему вопросов первый.

### 2.6.2. Ответ на вопрос

После того, как игрок ответил на вопрос, ведущему дается время на решение. Он должен решить, правильно ответил игрок
или нет.

Ответ отображается ведущему после того, как был выбран вопрос.

В зависимости от настроек комнаты, вопрос может отображаеться заранее, или только после того, как игрок дал ответ.

### 2.6.3. Изменение количества очков

Ведущий должен иметь возможность изменять количество очков у всех игроков в комнате.

### 2.6.4. Пауза

Ведущий должен иметь возможность поставить паузу.

### 2.6.5 Пропуск вопроса

Ведущий должен иметь возможность пропустить текущий вопрос.

## 2.7. Функционал комнаты

### 2.7.1. Выход из комнаты

Если ведущий выходит - игра ставится паузу.
Если игрок выходит - нет.
Все должны иметь возможность перезахода с сохранением всех результатов.

### 2.7.2 Текстовый чат

В комнате должен быть общий чат для игроков и ведущего.

## 3 Стек технологий

### 3.1. Сервер
- Golang 1.18+
- Router: go-chi
- Validation: go-ozzo
- PostgreSQL, pgx, сырые запросы sql
- Redis - кеширование и викторины
- Gorilla websockets

### 3.2. Веб приложение
- ?????????????????????????????????????
