---
openapi: 3.0.3
info:
  title: Answersuck backend API
  contact:
    email: contact@answersuck.com
  version: 0.0.1
servers:
- url: http://localhost:8080/api/v1
  description: Local server
tags:
- name: account
  description: Account operations
- name: auth
  description: Authentication operations
- name: session
  description: Session operations
- name: tag
  description: Tag operations
- name: language
  description: Language operations
- name: topic
  description: Topic operations
- name: question
  description: Question operations
- name: package
  description: Package operations
paths:
  /accounts:
    post:
      tags:
      - account
      summary: Create account
      description: This can only be done by providing email, username and password
      operationId: accountCreate
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AccountCreateRequest'
        required: true
      responses:
        "200":
          description: Account created.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AccountCreateResponse'
        "400":
          description: Invalid request body.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationErrorResponse'
        "409":
          description: Account with given email or username already exist.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        "500":
          description: Internal Server Error.
  /accounts/{accountId}:
    get:
      tags:
      - account
      summary: Get account
      operationId: accountGet
      parameters:
      - name: accountId
        in: path
        description: String ID of the account
        required: true
        style: simple
        explode: false
        schema:
          type: string
      responses:
        "200":
          description: Successful operation.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Account'
        "401":
          description: Unauthorized or expired session.
        "403":
          description: Access denied.
        "404":
          description: Account not found.
        "500":
          description: Internal Server Error.
      security:
      - cookieAuth: []
    delete:
      tags:
      - account
      summary: Delete account
      description: Only account with state set to `isArchive=false` can be deleted. Access token should be provided at query param, request it at `/auth/token/`.
      operationId: accountDelete
      parameters:
      - name: token
        in: query
        description: Short live access token
        required: true
        style: form
        explode: true
        schema:
          type: string
      - name: accountId
        in: path
        description: String ID of the account
        required: true
        style: simple
        explode: false
        schema:
          type: string
      responses:
        "204":
          description: Account deleted.
          headers:
            Set-Cookie:
              style: simple
              explode: false
              schema:
                type: string
                example: id=; Path=v1; Max-Age=-1; HttpOnly; Secure
        "401":
          description: Unauthorized.
        "403":
          description: Forbidden.
        "404":
          description: Account not found.
        "500":
          description: Internal Server Error.
      security:
      - cookieAuth: []
  /accounts/{accountId}/verification:
    post:
      tags:
      - account
      summary: Send verification email
      description: Send email verification to email address linked to the account
      operationId: accountRequestVerification
      parameters:
      - name: accountId
        in: path
        description: String ID of the account
        required: true
        style: simple
        explode: false
        schema:
          type: string
      responses:
        "202":
          description: Email verification link sent.
        "400":
          description: Bad request.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        "401":
          description: Unauthorized or expired session.
        "404":
          description: Account not found.
        "500":
          description: Internal Server Error.
      security:
      - cookieAuth: []
  /accounts/verification:
    put:
      tags:
      - account
      summary: Verify email
      description: To verify email, code as query parameter should be provided
      operationId: accountVerifyEmail
      parameters:
      - name: code
        in: query
        description: Verification code
        required: true
        style: form
        explode: true
        schema:
          type: string
      responses:
        "204":
          description: Email has been verified.
        "400":
          description: Bad request.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        "401":
          description: Unauthorized or expired session.
        "403":
          description: Invalid or expired access token.
        "404":
          description: Account not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        "500":
          description: Internal Server Error.
  /accounts/password/reset:
    put:
      tags:
      - account
      summary: Reset password
      description: To set new password, access token should be provided along side with new password
      operationId: accountResetPassword
      parameters:
      - name: token
        in: query
        description: Short live access token
        required: true
        style: form
        explode: true
        schema:
          type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AccountResetPasswordRequest'
        required: true
      responses:
        "204":
          description: New password set.
        "400":
          description: Invalid request body.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationErrorResponse'
        "403":
          description: Invalid or expired access token.
        "404":
          description: Account not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        "500":
          description: Internal Server Error.
    post:
      tags:
      - account
      summary: Send reset password link
      description: To request link to password reset, email or username should be provided. Email with code will be sent on success.
      operationId: accountForgotPassword
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AccountForgotPasswordRequest'
        required: true
      responses:
        "202":
          description: Email with link sent.
        "400":
          description: Invalid request body.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationErrorResponse'
        "404":
          description: Account not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        "500":
          description: Internal Server Error.
  /auth/login:
    post:
      tags:
      - auth
      summary: Login
      description: Creates new session and sets its id in cookies. Login might be email or username.
      operationId: authLogin
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
        required: true
      responses:
        "200":
          description: Logged in.
          headers:
            Set-Cookie:
              style: simple
              explode: false
              schema:
                type: string
                example: id=XN6StCMLLT4Ijc1fGhZPj83PJ2gjHrPB; Path=v1; Max-Age=60; HttpOnly; Secure
        "400":
          description: Invalid request body.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationErrorResponse'
        "401":
          description: Incorrect email or password.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        "406":
          description: Already logged in.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        "500":
          description: Internal Server Error.
  /auth/logout:
    post:
      tags:
      - auth
      summary: Logout
      description: Log out from current session
      operationId: authLogout
      responses:
        "204":
          description: Successful operation.
          headers:
            Set-Cookie:
              style: simple
              explode: false
              schema:
                type: string
                example: id=; Path=v1; Max-Age=-1; HttpOnly; Secure
        "401":
          description: Unauthorized.
        "403":
          description: Forbidden.
        "500":
          description: Internal Server Error.
      security:
      - cookieAuth: []
  /auth/token:
    post:
      tags:
      - auth
      summary: Request access token
      description: Request short live token which can be used to perform protected operations. Each token can be accepted by only one resource. Resource URI example - `localhost:8080/api/v1/sessions/:sessionId`
      operationId: authToken
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AccessTokenRequest'
        required: true
      responses:
        "200":
          description: Successful operation.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AccessTokenResponse'
        "400":
          description: Invalid request body.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationErrorResponse'
        "401":
          description: Unauthorized.
        "403":
          description: Forbidden.
        "500":
          description: Internal Server Error.
      security:
      - cookieAuth: []
  /sessions:
    get:
      tags:
      - session
      summary: Get sessions
      operationId: sessionGetAccount
      responses:
        "200":
          description: Successful operation.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SessionArray'
        "401":
          description: Unauthorized.
        "500":
          description: Internal Server Error.
      security:
      - cookieAuth: []
    delete:
      tags:
      - session
      summary: Terminate all sessions
      description: To terminate all user sessions, access token should be provided at query param, request it at `/auth/token/`
      operationId: sessionDelete
      parameters:
      - name: token
        in: query
        description: Short live access token
        required: true
        style: form
        explode: true
        schema:
          type: string
      responses:
        "204":
          description: Successful operation.
        "401":
          description: Unauthorized.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        "403":
          description: Invalid or expired access token.
        "500":
          description: Internal Server Error.
      security:
      - cookieAuth: []
  /sessions/{sessionId}:
    delete:
      tags:
      - session
      summary: Terminate session
      description: To terminate user session access token should be provided at query parameters, request it at `/auth/token/`
      operationId: sessionDeleteUser
      parameters:
      - name: sessionId
        in: path
        description: String ID of the session to terminate
        required: true
        style: simple
        explode: false
        schema:
          type: string
      - name: token
        in: query
        description: Short live access token
        required: true
        style: form
        explode: true
        schema:
          type: string
      responses:
        "204":
          description: Successful operation.
        "400":
          description: Bad request.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        "401":
          description: Unauthorized.
        "403":
          description: Invalid or expired access token.
        "500":
          description: Internal Server Error.
      security:
      - cookieAuth: []
  /tags:
    get:
      tags:
      - tag
      summary: Get tags
      operationId: tagGetAll
      responses:
        "200":
          description: Successful operation.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TagArray'
  /languages:
    get:
      tags:
      - language
      summary: Get languages
      operationId: languageGetAll
      responses:
        "200":
          description: Successful operation.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LanguageArray'
  /questions:
    get:
      tags:
      - question
      summary: Get questions
      operationId: questionGetAll
      responses:
        "200":
          description: Successful operation.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QuestionArray'
    post:
      tags:
      - question
      summary: Create question
      operationId: questionCreate
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QuestionCreateRequest'
        required: true
      responses:
        "200":
          description: Successful operation.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QuestionCreateResponse'
      security:
      - cookieAuth: []
  /questions/media:
    post:
      tags:
      - question
      summary: Upload question media
      operationId: questionMediaUpload
      responses:
        "200":
          description: Successful operation.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QuestionMedia'
      security:
      - cookieAuth: []
  /questions/answer/image:
    post:
      tags:
      - question
      summary: Upload answer image
      operationId: answerImageUpload
      responses:
        "200":
          description: Successful operation.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AnswerImage'
      security:
      - cookieAuth: []
  /topics:
    get:
      tags:
      - topic
      summary: Get topics
      operationId: topicGetAll
      responses:
        "200":
          description: Successful operation.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TopicArray'
    post:
      tags:
      - topic
      summary: Create topic
      operationId: topicCreate
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TopicCreateRequest'
        required: true
      responses:
        "200":
          description: Successful operation.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Topic'
      security:
      - cookieAuth: []
  /packages:
    get:
      tags:
      - package
      summary: Get packages
      operationId: packageGetAll
      responses:
        "200":
          description: Successful operation.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PackageArray'
    post:
      tags:
      - package
      summary: Create package
      operationId: packageCreate
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PackageCreateRequest'
        required: true
      responses:
        "200":
          description: Successful operation.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PackageCreateResponse'
      security:
      - cookieAuth: []
  /packages/cover:
    post:
      tags:
      - package
      summary: Upload package cover
      operationId: packagesCoverUpload
      responses:
        "200":
          description: Successful operation.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PackageCover'
      security:
      - cookieAuth: []
components:
  schemas:
    Account:
      type: object
      properties:
        id:
          type: string
          description: UUID v4
          format: uuid
        username:
          maxLength: 16
          minLength: 4
          type: string
        email:
          maxLength: 255
          type: string
          format: email
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        archived:
          type: boolean
          description: false by default
        verified:
          type: boolean
          description: false by default, true for social auth
        avatarUrl:
          type: string
          format: url
    AccountCreateRequest:
      required:
      - email
      - password
      - username
      type: object
      properties:
        username:
          maxLength: 16
          minLength: 4
          type: string
        email:
          maxLength: 255
          type: string
          format: email
        password:
          maxLength: 64
          minLength: 8
          type: string
          format: password
    AccountCreateResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
    AccountForgotPasswordRequest:
      required:
      - login
      type: object
      properties:
        login:
          type: string
          format: email or username
    AccountResetPasswordRequest:
      required:
      - password
      type: object
      properties:
        password:
          maxLength: 64
          minLength: 4
          type: string
          format: password
    LoginRequest:
      required:
      - login
      - password
      type: object
      properties:
        login:
          type: string
          format: email or username
        password:
          type: string
          format: password
    AccessTokenRequest:
      required:
      - audience
      - password
      type: object
      properties:
        audience:
          type: string
          format: uri
        password:
          type: string
          format: password
    AccessTokenResponse:
      type: object
      properties:
        token:
          type: string
          description: JWT token contains Account ID as subject, audience in payload
    ErrorResponse:
      type: object
      properties:
        error:
          type: string
        detail:
          type: string
          example: ""
    ValidationErrorResponse:
      type: object
      properties:
        error:
          type: string
        detail:
          $ref: '#/components/schemas/ValidationErrorResponseDetail'
    ValidationErrorResponseDetail:
      type: object
      properties:
        fieldName:
          type: string
    Session:
      type: object
      properties:
        id:
          type: string
        userAgent:
          type: string
        ip:
          type: string
          format: ipv4
        createdAt:
          type: string
          format: timestamp
    SessionArray:
      type: array
      items:
        $ref: '#/components/schemas/Session'
    Tag:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        languageId:
          type: integer
    TagArray:
      type: array
      items:
        $ref: '#/components/schemas/Tag'
    Language:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
    LanguageArray:
      type: array
      items:
        $ref: '#/components/schemas/Language'
    Topic:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        languageId:
          type: integer
        createdAt:
          type: string
          format: date-time
    TopicArray:
      type: array
      items:
        $ref: '#/components/schemas/Topic'
    TopicCreateRequest:
      required:
      - languageId
      - name
      type: object
      properties:
        name:
          type: string
        languageId:
          type: integer
    QuestionType:
      type: string
      enum:
      - DEFAULT
      - BET
      - SECRET
      - SUPERSECRET
      - SAFE
    MediaType:
      type: string
      enum:
      - AUDIO
      - IMG
      - VIDEO
    QuestionMedia:
      type: object
      properties:
        id:
          type: integer
        url:
          type: string
          format: uri
        type:
          $ref: '#/components/schemas/MediaType'
    AnswerImage:
      type: object
      properties:
        id:
          type: integer
        url:
          type: string
          format: uri
    Answer:
      type: object
      properties:
        id:
          type: integer
        answer:
          type: string
        imageUrl:
          type: string
          format: uri
    Question:
      type: object
      properties:
        id:
          type: integer
        question:
          type: string
        answer:
          type: string
        answerImage:
          type: string
          format: uri
        media:
          type: string
        mediaType:
          $ref: '#/components/schemas/MediaType'
        author:
          type: string
        languageId:
          type: integer
        createdAt:
          type: string
          format: date-time
    QuestionArray:
      type: array
      items:
        $ref: '#/components/schemas/Question'
    QuestionCreateRequest:
      required:
      - answer
      - languageId
      - question
      type: object
      properties:
        question:
          type: string
        answer:
          maximum: 128
          minimum: 6
          type: string
        answerImageId:
          type: integer
        languageId:
          type: integer
        mediaId:
          type: integer
    QuestionCreateResponse:
      type: object
      properties:
        id:
          type: integer
    Stage:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        final:
          type: boolean
          description: indicates that stage is final or not
        content:
          type: array
          items:
            $ref: '#/components/schemas/StageContent'
    StageNested:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        final:
          type: boolean
          description: indicates that stage is final or not
        content:
          type: array
          items:
            $ref: '#/components/schemas/StageContentNested'
    StageContentNested:
      type: object
      properties:
        topic:
          $ref: '#/components/schemas/Topic'
        question:
          $ref: '#/components/schemas/Question'
        answer:
          $ref: '#/components/schemas/Answer'
    StageContent:
      type: object
      properties:
        topicId:
          type: integer
        questionId:
          type: integer
        answerId:
          type: integer
    StageArray:
      type: array
      items:
        $ref: '#/components/schemas/Stage'
    StageNestedArray:
      type: array
      items:
        $ref: '#/components/schemas/StageNested'
    StageCreateRequest:
      required:
      - final
      - name
      - topics
      type: object
      properties:
        name:
          maximum: 32
          minimum: 6
          type: string
        final:
          type: boolean
        content:
          type: array
          items:
            $ref: '#/components/schemas/StageContentCreateRequest'
    StageContentCreateRequest:
      required:
      - cost
      - interval
      - questionId
      - topicId
      - type
      type: object
      properties:
        topicId:
          type: integer
        questionId:
          type: integer
        type:
          $ref: '#/components/schemas/QuestionType'
        cost:
          type: integer
        interval:
          type: integer
        comment:
          type: string
        secretTopic:
          type: string
          description: topic for SECRET or SUPERSECRET question
        secretCost:
          type: integer
          description: cost for SECRET or SUPERSECRET question
        keepable:
          type: boolean
          description: indicator of whether you can leave q to yourself
        visible:
          type: boolean
          description: indicator that topic and cost are visible to players or not
    Package:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        languageId:
          type: integer
        coverUrl:
          type: string
          format: uri
        published:
          type: boolean
        stages:
          $ref: '#/components/schemas/StageNestedArray'
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    PackageArray:
      type: array
      items:
        $ref: '#/components/schemas/Package'
    PackageCreateRequest:
      required:
      - languageId
      - name
      - stages
      type: object
      properties:
        name:
          type: string
        languageId:
          type: integer
        coverId:
          type: integer
        stages:
          type: array
          items:
            $ref: '#/components/schemas/StageCreateRequest'
    PackageCreateResponse:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        languageId:
          type: integer
        coverUrl:
          type: string
          format: uri
        published:
          type: boolean
        stages:
          $ref: '#/components/schemas/StageArray'
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    PackageCover:
      type: object
      properties:
        id:
          type: integer
          format: int64
        url:
          type: string
          format: uri
  securitySchemes:
    cookieAuth:
      type: apiKey
      name: id
      in: cookie
